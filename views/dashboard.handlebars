{{!-- Include main layout --}}
{{!-- {{> main}} --}}

{{!-- Main content --}}
<div class="container">
    <h1 class="mt-4 mb-4">Your Dashboard</h1>

    {{!-- Optional: Display the user's name or username if available --}}
    {{#if user.username}}
        <h2>Welcome back, {{user.username}}!</h2>
    {{/if}}

    {{!-- Section for displaying workout details --}}
    <div id="workouts-container">
        {{!-- Container for dynamically loaded workouts --}}
        {{#each workouts}}
            <div class="workout-card">
                <h3>{{this.name}}</h3>
                <p>Workout Type: {{this.type}}</p>
                <p>Duration: {{this.duration}} minutes</p>
                <p>Calories Burned: {{this.caloriesBurned}}</p>
            </div>
        {{/each}}
    </div>

    {{!-- Button to toggle the display of the new workout form --}}
    <button id="toggle-workout-form" class="btn btn-primary mt-3">Add New Workout</button>

    {{!-- Form for adding a new workout --}}
    <div id="workout-form" style="display:none;">
        <form id="add-workout-form">
            <div class="form-group">
                <label for="workout-name">Workout Name:</label>
                <input type="text" class="form-control" id="workout-name" name="workout-name" required>
            </div>
            <div class="form-group">
                <label for="workout-type">Workout Type:</label>
                <input type="text" class="form-control" id="workout-type" name="workout-type" required>
            </div>
            <div class="form-group">
                <label for="workout-duration">Duration (minutes):</label>
                <input type="number" class="form-control" id="workout-duration" name="workout-duration" required>
            </div>
            <div class="form-group">
                <label for="calories-burned">Calories Burned:</label>
                <input type="number" class="form-control" id="calories-burned" name="calories-burned" required>
            </div>
            <button type="submit" class="btn btn-primary mt-3">Add Workout</button>
        </form>
    </div>
</div>

{{!-- Script to handle the toggling of the workout form --}}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const toggleWorkoutFormBtn = document.getElementById('toggle-workout-form');
        const workoutForm = document.getElementById('workout-form');

        toggleWorkoutFormBtn.addEventListener('click', function() {
            if (workoutForm.style.display === 'none' || workoutForm.style.display === '') {
                workoutForm.style.display = 'block';
            } else {
                workoutForm.style.display = 'none';
            }
        });
    });
</script>

<script>
    // JavaScript code to fetch and display workouts
    async function fetchAndDisplayWorkouts() {
        try {
            const response = await fetch('/api/workouts');
            const workouts = await response.json();
            const workoutsContainer = document.getElementById('workouts-container');
            workoutsContainer.innerHTML = ''; // Clear existing workouts
            workouts.forEach(workout => {
                const workoutElement = document.createElement('div');
                workoutElement.classList.add('workout-card');
                workoutElement.innerHTML = `
                    <h3>${workout.name}</h3>
                    <p>Workout Type: ${workout.type}</p>
                    <p>Duration: ${workout.duration} minutes</p>
                    <p>Calories Burned: ${workout.caloriesBurned}</p>
                `;
                workoutsContainer.appendChild(workoutElement);
            });
        } catch (error) {
            console.error('Error fetching workouts:', error);
        }
    }

    document.addEventListener('DOMContentLoaded', fetchAndDisplayWorkouts);

    // JavaScript code to handle form submission for adding a workout
    document.getElementById('add-workout-form').addEventListener('submit', async function(event) {
        event.preventDefault(); // Prevent the default form submission

        const workoutData = {
            name: document.getElementById('workout-name').value,
            type: document.getElementById('workout-type').value,
            duration: document.getElementById('workout-duration').value,
            caloriesBurned: document.getElementById('calories-burned').value
        };

        try {
            const response = await fetch('/api/workouts/add', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(workoutData)
            });
            if (response.ok) {
                // Refresh the list of workouts if the workout was added successfully
                fetchAndDisplayWorkouts();
                // Clear the form fields
                document.getElementById('workout-name').value = '';
                document.getElementById('workout-type').value = '';
                document.getElementById('workout-duration').value = '';
                document.getElementById('calories-burned').value = '';
                // Hide the form
                document.getElementById('workout-form').style.display = 'none';
            } else {
                console.error('Error adding workout:', response.statusText);
            }
        } catch (error) {
            console.error('Error adding workout:', error);
        }
    });
</script>
